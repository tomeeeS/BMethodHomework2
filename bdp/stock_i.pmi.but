Flag(FileOn("stock_i.pmi.res")) & Set(toto | NAT = 0..2147483647 & INT = -2147483648..2147483647 & btrue & {1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}: 1..5 +-> 0..4000 & dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}) = 1..5 & {1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}: 1..5 --> 0..4000 & MaxStocks = {1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000} & CurrentStocks: 1..5 +-> 0..4000 & dom(CurrentStocks) = 1..5 & CurrentStocks: 1..5 --> 0..4000 & Shortages: FIN(1..5) & RequiredAmounts: 1..5 +-> 0..4000 & dom(RequiredAmounts) = 1..5 & RequiredAmounts: 1..5 --> 0..4000 & dom(CurrentStocks) = dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}) & !ii.(ii: dom(CurrentStocks) => CurrentStocks(ii): 0..({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)) & !xx.(xx: Shortages => 0<= -1-CurrentStocks(xx)+({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx)/2 & CurrentStocks(xx)+1<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx)/2) & !xx.(xx: dom(CurrentStocks) & (0<= -1-CurrentStocks(xx)+({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx)/2 & CurrentStocks(xx)+1<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx)/2) => xx: Shortages) & !ii.(ii: dom(RequiredAmounts) => RequiredAmounts(ii) = ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)-CurrentStocks(ii) & RequiredAmounts(ii) = ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)-CurrentStocks(ii)) & cShortages$1: 1..5 +-> BOOL & dom(cShortages$1) = 1..5 & cShortages$1: 1..5 --> BOOL & dom(cShortages$1|>{TRUE}) = Shortages & dom(cShortages$1|>{FALSE}) = (1..5)-Shortages & !ii.(ii: dom(CurrentStocks) => CurrentStocks(ii)<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)) & !xx.(xx: dom(cShortages$1|>{TRUE}) => 0<= -1-CurrentStocks(xx)+({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx)/2 & CurrentStocks(xx)+1<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx)/2) & !xx.(xx: dom(CurrentStocks) & (0<= -1-CurrentStocks(xx)+({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx)/2 & CurrentStocks(xx)+1<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx)/2) => xx: dom(cShortages$1|>{TRUE})) & cRequiredAmounts$1 = RequiredAmounts & cCurrentStocks$1 = CurrentStocks & ii: dom(CurrentStocks) & amt: 1..4000 & CurrentStocks(ii)+amt: 0..4000 & CurrentStocks(ii)+amt<=MaxStocks(ii) & MaxStocks(ii)-(CurrentStocks(ii)+amt): 0..4000 & xx: dom(cShortages$1<+{ii|->bool(CurrentStocks(ii)+amt+1<=MaxStocks(ii)/2)}|>{TRUE}) & "Refinement is correct" & ii,ii = xx & 2: 0..4000 & 2: 1..4000 & 2: 1..5 & 2: 0..2147483647 & 0<=2 & 2: INTEGER & 2: dom(cShortages$1) & 2: dom(RequiredAmounts) & 2: dom(CurrentStocks) & 2: dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}) & 2: NAT & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx): ran({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}) & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx): 0..4000 & {1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}: 1..5 <-> 0..4000 & 4000: 0..4000 & 4000: 1..4000 & 4000: 0..2147483647 & 0<=4000 & 4000: INTEGER & 4000: NAT & 5: 0..4000 & 5: 1..4000 & 5: 1..5 & 0<=5 & 5: INTEGER & 5: dom(cShortages$1) & 5: dom(RequiredAmounts) & 5: dom(CurrentStocks) & 5: dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}) & 0<=125 & 125: INTEGER & 0<=4 & 4: INTEGER & 0<=500 & 500: INTEGER & 0<=3 & 3: INTEGER & not({1|->1000}\/{2|->2000} = {}) & 0<=2000 & 2000: INTEGER & 0<=1000 & 1000: INTEGER & ii|->CurrentStocks(ii)+amt: dom(CurrentStocks)*(0..4000) & CurrentStocks(ii): ran(CurrentStocks) & CurrentStocks(ii): 0..4000 & ii: 1..5 & ii: dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}) & ii: dom(cShortages$1) & ii: dom(RequiredAmounts) & CurrentStocks: 1..5 <-> 0..4000 & -1: INTEGER & RequiredAmounts(2) = ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(2)-CurrentStocks(2) & CurrentStocks(2)<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(2) & CurrentStocks(2): 0..({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(2) & 2<=2147483647 & 0<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx) & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx)<=4000 & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx): INTEGER & dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}): POW(1..5) & ran({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}): POW(0..4000) & CurrentStocks(ii): INTEGER & MaxStocks(ii)-(CurrentStocks(ii)+amt): INTEGER & CurrentStocks(ii)+amt: INTEGER & 0<=CurrentStocks(ii) & 0<=MaxStocks(ii)-(CurrentStocks(ii)+amt) & 0<=CurrentStocks(ii)+amt & 4000<=2147483647 & RequiredAmounts(5) = ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(5)-CurrentStocks(5) & CurrentStocks(5)<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(5) & CurrentStocks(5): 0..({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(5) & not({} = {1|->1000}\/{2|->2000}) & CurrentStocks(ii)<=4000 & 1<=ii & ii<=5 & dom(CurrentStocks): POW(1..5) & ran(CurrentStocks): POW(0..4000) & 0<=CurrentStocks(2) & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(xx)<=2147483647 & 0<=MaxStocks(ii) & CurrentStocks(ii)<=2147483647 & 0<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(2) & 5|->4000: dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})*NAT & 5|->4000: dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})*INTEGER & 5|->4000: dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})*(0..2147483647) & 5|->4000: dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})*(1..4000) & 5|->4000: dom({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})*(0..4000) & 5|->4000: dom(CurrentStocks)*NAT & 5|->4000: dom(CurrentStocks)*INTEGER & 5|->4000: dom(CurrentStocks)*(0..2147483647) & 5|->4000: dom(CurrentStocks)*(1..4000) & 5|->4000: dom(CurrentStocks)*(0..4000) & 5: 0..2147483647 & 5: NAT & 5<=2147483647 & ii<=2147483647 & 5|->4000: NAT*NAT & 5|->4000: NAT*INTEGER & 5|->4000: NAT*(0..2147483647) & 5|->4000: NAT*(1..4000) & 5|->4000: NAT*(0..4000) & 5|->4000: (0..2147483647)*NAT & 5|->4000: (0..2147483647)*INTEGER & 5|->4000: (0..2147483647)*(0..2147483647) & 5|->4000: (0..2147483647)*(1..4000) & 5|->4000: (0..2147483647)*(0..4000) & 0<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii) & 0<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)-CurrentStocks(ii)-amt & CurrentStocks(ii)+amt<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii) & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)-(CurrentStocks(ii)+amt): INTEGER & xx: (cShortages$1~|>>{ii}\/{bool(0<= -1-CurrentStocks(ii)-amt+({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)/2)|->ii})[{TRUE}] & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)-(CurrentStocks(ii)+amt): 0..4000 & 0<=4000-({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)+CurrentStocks(ii)+amt & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)-(CurrentStocks(ii)+amt)<=4000 & 0<=({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)-(CurrentStocks(ii)+amt) & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)-(CurrentStocks(ii)+amt)<=2147483647 & xx = ii & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii): ran({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000}) & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii): 0..4000 & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii): INTEGER & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii): {1000}\/{2000}\/{500}\/{125}\/{4000} & ii: (cShortages$1~|>>{ii}\/{bool(0<= -1-CurrentStocks(ii)-amt+({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)/2)|->ii})[{TRUE}] & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)<=2147483647 & ({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)<=4000 & ii,ii = ii & CurrentStocks(ii)+amt<=2147483647 & CurrentStocks(ii)+amt<=4000 & 0<=4000-CurrentStocks(ii)-amt & 0<=2147483647-CurrentStocks(ii)-amt => [ii:=ii,ii][ii:=ii,ii][ii:=ii,ii](0<= -1-CurrentStocks(ii)-amt+({1|->1000}\/{2|->2000}\/{3|->500}\/{4|->125}\/{5|->4000})(ii)/2))